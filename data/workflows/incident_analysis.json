{
  "id": "incident_analysis",
  "name": "Analyse d'activit√© suspecte ou compromission",
  "version": "1.0",
  "description": "M√©thodologie pour identifier, analyser et traiter une compromission ou une activit√© inhabituelle sur un syst√®me Windows ou Linux.",
  "tags": ["incident", "piratage", "analyse", "linux", "windows", "compromission"],
  "meta": {
    "created_by": "admin",
    "created_at": "2025-07-17"
  },
  "flow": [
    {
      "id": "trigger_windows",
      "title": "D√©tection initiale (Windows)",
      "type": "evidence_windows",
      "description": "Identification de l‚Äôanomalie sur un h√¥te Windows.",
      "long_description": "Utilisez l‚ÄôObservateur d‚Äô√©v√©nements pour rechercher :\n- ID 4624/4625 (connexions r√©ussies ou √©chou√©es)\n- ID 4688 (cr√©ation de processus)\n- Activit√© antivirus (Defender, ESET...)\n\nCommandes utiles :\n<pre>powershell\nGet-EventLog -LogName Security -Newest 50\n</pre>\n\nüîó Voir aussi : [Sysmon pour Windows](https://learn.microsoft.com/fr-fr/sysinternals/downloads/sysmon)",
      "next": ["scope_windows"]
    },
    {
      "id": "trigger_linux",
      "title": "D√©tection initiale (Linux)",
      "type": "evidence_linux",
      "description": "D√©tection d‚Äôactivit√© inhabituelle sur un syst√®me Linux (debian).",
      "long_description": "- Examiner les logs : <pre>/var/log/auth.log</pre><pre>/var/log/syslog</pre><pre>/var/log/messages</pre>- V√©rifier les connexions SSH suspectes :<pre>bash\ntail -n 100 /var/log/auth.log | grep ssh\n</pre>- Processus anormaux : <pre>ps aux | grep -v root</pre>- Utiliser <pre>auditd</pre><pre>logwatch</pre> Pour Arch (et d√©riv√©, ex: manjaro):\n- Examiner les logs via <code>journalctl</code>\nCommandes utiles :<pre>journalctl -xe</pre><pre>journalctl _COMM=sshd</pre><pre>journalctl --since '1 hour ago'</pre>Pour d√©tecter les connexions SSH :<pre>journalctl -u sshd | grep 'Failed|Accepted'</pre>D√©tection de processus anormaux :<pre>ps aux --sort=-%cpu | head</pre>Autres outils :\n- <code>auditd</code> (√† activer manuellement sur Arch)\n- <code>logwatch</code> (peut √™tre install√© via AUR)\n- <code>systemd-analyze</code> pour les lenteurs de d√©marrage suspectes",
      "next": ["scope_linux"]
    },
    {
      "id": "scope_windows",
      "title": "D√©limiter l'√©tendue (Windows)",
      "type": "action_windows",
      "description": "V√©rifier si d'autres comptes ou machines sont affect√©s.",
      "long_description": "- Lister les utilisateurs actifs : `query user`\n- V√©rifier les connexions r√©seau : `netstat -ano`\n- Regarder les processus inconnus : `tasklist /v`\n- Ouvrir le gestionnaire de t√¢ches avec `Ctrl+Shift+Esc`\n\nUtiliser aussi :\n```powershell\nGet-Process | Sort CPU -Descending\n```",
      "next": ["evidence_windows"]
    },
    {
      "id": "scope_linux",
      "title": "D√©limiter l'√©tendue (Linux)",
      "type": "action_linux",
      "description": "Analyser si l‚Äôincident est local ou global.",
      "long_description": "- Qui est connect√© : `who`, `w`, `last`\n- Ports ouverts : `ss -tuna`, `netstat -plnt`\n- Services actifs : `systemctl`, `chkconfig`, `ps aux`",
      "next": ["evidence_linux"]
    },
    {
      "id": "evidence_windows",
      "title": "Collecte des preuves (Windows)",
      "type": "evidence_windows",
      "description": "Sauvegarder les journaux avant d‚Äôagir.",
      "long_description": "- Exporter les journaux via Event Viewer (clic droit > Enregistrer).\n- Copier les fichiers `.evtx` :\n```powershell\nwevtutil epl Security C:\\Temp\\security_log.evtx\n```\n- Dump m√©moire (optionnel) avec Sysinternals : `procdump`, `RAMCapturer`",
      "next": ["pivot_windows"]
    },
    {
      "id": "evidence_linux",
      "title": "Collecte des preuves (Linux)",
      "type": "evidence_linux",
      "description": "Archiver les fichiers utiles √† l‚Äôanalyse.",
      "long_description": "- Copier les fichiers log :\n```bash\ncp /var/log/auth.log /tmp/\ncp -r ~/.bash_history /tmp/\n```\n- Lister les fichiers r√©cents :\n```bash\nfind / -type f -mtime -1 2>/dev/null\n```",
      "next": ["pivot_linux"]
    },
    {
      "id": "pivot_windows",
      "title": "Analyse chronologique (Windows)",
      "type": "action_windows",
      "description": "Reconstituer l‚Äôordre des actions malveillantes.",
      "long_description": "- Utiliser les horodatages des journaux\n- Rechercher des scripts ou fichiers suspects dans `%TEMP%`, `%APPDATA%`\n- Examiner les cl√©s Run / RunOnce dans le Registre",
      "next": ["isolate_windows"]
    },
    {
      "id": "pivot_linux",
      "title": "Analyse chronologique (Linux)",
      "type": "action_linux",
      "description": "Comprendre comment l‚Äôintrus a agi.",
      "long_description": "- Examiner `~/.bash_history`, `~/.ssh/authorized_keys`\n- Regarder les scripts ou binaires dans `/tmp`, `/dev/shm`, `/var/tmp`\n- V√©rifier les t√¢ches cron suspectes : `crontab -l`, `/etc/cron*`",
      "next": ["isolate_linux"]
    },
    {
      "id": "isolate_windows",
      "title": "Isolement du syst√®me (Windows)",
      "type": "action_windows",
      "description": "Emp√™cher la propagation.",
      "long_description": "- D√©connecter du r√©seau (`ipconfig /release`, ou d√©sactiver l‚Äôinterface).\n- D√©sactiver les comptes suspects :\n```powershell\ndisable-localuser <nom>\n```",
      "next": ["fix_windows"]
    },
    {
      "id": "isolate_linux",
      "title": "Isolement du syst√®me (Linux)",
      "type": "action_linux",
      "description": "Limiter l'acc√®s de l‚Äôattaquant.",
      "long_description": "- Fermer la connexion SSH : `kill -9 <PID>`\n- D√©sactiver temporairement le r√©seau :\n```bash\nip link set eth0 down\n```\n- Changer le mot de passe root : `passwd`",
      "next": ["fix_linux"]
    },
    {
      "id": "fix_windows",
      "title": "Nettoyage et correction (Windows)",
      "type": "action_windows",
      "description": "Supprimer les portes d√©rob√©es.",
      "long_description": "- Supprimer les t√¢ches planifi√©es suspectes : `schtasks /query`\n- Supprimer les services inconnus : `services.msc`\n- Nettoyer les clefs Registre li√©es √† l‚Äôautostart :\n```powershell\nGet-ItemProperty 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n```",
      "next": ["harden_windows"]
    },
    {
      "id": "fix_linux",
      "title": "Nettoyage et correction (Linux)",
      "type": "action_linux",
      "description": "Supprimer les √©l√©ments malveillants.",
      "long_description": "- Supprimer les utilisateurs inconnus de `/etc/passwd`\n- Supprimer les services inconnus dans `/etc/systemd/system`\n- Nettoyer les cl√©s SSH : `~/.ssh/authorized_keys`",
      "next": ["harden_linux"]
    },
    {
      "id": "harden_windows",
      "title": "Durcissement post-incident (Windows)",
      "type": "action_windows",
      "description": "S√©curiser durablement la machine.",
      "long_description": "- Appliquer les derni√®res mises √† jour Windows\n- Mettre en place LAPS\n- D√©sactiver les comptes Admin inutilis√©s\n- Activer la journalisation avanc√©e via GPO",
      "next": ["report_windows"]
    },
    {
      "id": "harden_linux",
      "title": "Durcissement post-incident (Linux)",
      "type": "action_linux",
      "description": "S√©curisation permanente de l'h√¥te.",
      "long_description": "- Appliquer les mises √† jour : `apt upgrade`, `yum update`\n- Restreindre l‚Äôacc√®s SSH :\n```bash\nPermitRootLogin no\nAllowUsers admin1\n```",
      "next": ["report_linux"]
    },
    {
      "id": "report_windows",
      "title": "Rapport d‚Äôincident (Windows)",
      "type": "checkpoint_windows",
      "description": "R√©diger le rapport de l‚Äôincident trait√©.",
      "long_description": "- Horodatage, comptes affect√©s, failles exploit√©es\n- Actions entreprises, dur√©e d‚Äôimpact\n- Document Word / Markdown / outil interne de suivi",
      "next": []
    },
    {
      "id": "report_linux",
      "title": "Rapport d‚Äôincident (Linux)",
      "type": "checkpoint_linux",
      "description": "Documenter et consigner l‚Äôincident.",
      "long_description": "- Description de l‚Äôattaque, vecteurs d‚Äôentr√©e, dur√©e\n- Preuves conserv√©es, actions correctives, recommandations",
      "next": []
    }
  ]
}
